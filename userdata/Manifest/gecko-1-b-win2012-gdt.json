{
  "Components": [
    {
      "ComponentName": "LogDirectory",
      "ComponentType": "DirectoryCreate",
      "Comment": "Required by OpenCloudConfig for DSC logging",
      "Path": "C:\\log"
    },
    {
      "ComponentName": "NxLog",
      "ComponentType": "MsiInstall",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Url": "http://nxlog.co/system/files/products/files/1/nxlog-ce-2.9.1716.msi",
      "Name": "NxLog-CE",
      "ProductId": "FC526514-AFD9-4A5C-8677-56241539609D",
      "sha512": "70f5516bca0ff7814833ef397c01dbcd1c7011c0ef4b0f2aeda2e1aa7c02fe680eddfd1c0656f8d438559e34e5a841360dc6dafa7843c610528df2e1defb02be"
    },
    {
      "ComponentName": "PaperTrailEncryptionCertificate",
      "ComponentType": "ChecksumFileDownload",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Source": "https://papertrailapp.com/tools/papertrail-bundle.pem",
      "Target": "C:\\Program Files (x86)\\nxlog\\cert\\papertrail-bundle.pem",
      "DependsOn": [
        {
          "ComponentType": "MsiInstall",
          "ComponentName": "NxLog"
        }
      ]
    },
    {
      "ComponentName": "NxLogPaperTrailConfiguration",
      "ComponentType": "ChecksumFileDownload",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Source": "https://raw.githubusercontent.com/mozilla-releng/OpenCloudConfig/master/userdata/Configuration/nxlog/win2012.conf",
      "Target": "C:\\Program Files (x86)\\nxlog\\conf\\nxlog.conf",
      "DependsOn": [
        {
          "ComponentType": "ChecksumFileDownload",
          "ComponentName": "PaperTrailEncryptionCertificate"
        }
      ]
    },
    {
      "ComponentName": "Start_nxlog",
      "ComponentType": "ServiceControl",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Name": "nxlog",
      "StartupType": "Automatic",
      "State": "Running",
      "DependsOn": [
        {
          "ComponentType": "ChecksumFileDownload",
          "ComponentName": "NxLogPaperTrailConfiguration"
        }
      ]
    },
    {
      "ComponentName": "DisableIndexing",
      "ComponentType": "DisableIndexing",
      "Comment": "Disable indexing on all disk volumes (for performance)"
    },
    {
      "ComponentName": "ProcessExplorer",
      "ComponentType": "ZipInstall",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Url": "https://download.sysinternals.com/files/ProcessExplorer.zip",
      "Destination": "C:\\ProcessExplorer",
      "sha512": "ef89598b2d7f4659a98b0ace28f5b5274a93203d2a2296e37eadedf8cb0337ee5ccc161377644dae1c3e8526fc2545190077635e07458f7e4e74c5b3241f5e30"
    },
    {
      "ComponentName": "ProcessMonitor",
      "ComponentType": "ZipInstall",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Url": "https://download.sysinternals.com/files/ProcessMonitor.zip",
      "Destination": "C:\\ProcessMonitor",
      "sha512": "0269c0354eb21345abe28da97043c88da2de2f27f84030c6746b7019368b482027a6a9ef48d715e11e389c7e12a89b8d638408f8826cebf72b886ec24ea776a1"
    },
    {
      "ComponentName": "GpgForWin",
      "ComponentType": "ExeInstall",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Url": "http://files.gpg4win.org/gpg4win-2.3.0.exe",
      "Arguments": [
        "/S"
      ],
      "Validate": {
        "PathsExist": [
          "C:\\Program Files (x86)\\GNU\\GnuPG\\pub\\gpg.exe",
          "C:\\Program Files (x86)\\GNU\\GnuPG\\pub\\gpg2.exe"
        ]
      },
      "sha512": "b1c48d84d041055db3d3e3cbd22ef2f3300728b06c76660b9b78ececf56b7ccbc80addb39a64c0a4eb68bf3463ceb6d254dedda047049ce680e9d543dd8a9af9"
    },
    {
      "ComponentName": "SublimeText3",
      "ComponentType": "ExeInstall",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Url": "https://download.sublimetext.com/Sublime%20Text%20Build%203114%20x64%20Setup.exe",
      "Arguments": [
        "/VERYSILENT",
        "/NORESTART",
        "/TASKS=\"contextentry\""
      ],
      "Validate": {
        "PathsExist": [
          "C:\\Program Files\\Sublime Text 3\\subl.exe",
          "C:\\Program Files\\Sublime Text 3\\sublime_text.exe"
        ]
      },
      "sha512": "d3e71b28567ddd1b486aa3dcc9814818d91c322bc20ec203018d74bc465835f9ddd34d78f674172d00e66b39443070eb45e9799e3801b0ac410c958b2cf21098"
    },
    {
      "ComponentName": "SublimeText3_PackagesFolder",
      "ComponentType": "DirectoryCreate",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Path": "C:\\Users\\Administrator\\AppData\\Roaming\\Sublime Text 3\\Packages"
    },
    {
      "ComponentName": "SublimeText3_PackageControl",
      "ComponentType": "FileDownload",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Source": "http://sublime.wbond.net/Package%20Control.sublime-package",
      "Target": "C:\\Users\\Administrator\\AppData\\Roaming\\Sublime Text 3\\Packages\\Package Control.sublime-package",
      "DependsOn": [
        {
          "ComponentType": "ExeInstall",
          "ComponentName": "SublimeText3"
        },
        {
          "ComponentType": "DirectoryCreate",
          "ComponentName": "SublimeText3_PackagesFolder"
        }
      ]
    },
    {
      "ComponentName": "SystemPowerShellProfile",
      "ComponentType": "FileDownload",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Source": "https://raw.githubusercontent.com/mozilla-releng/OpenCloudConfig/master/userdata/Configuration/Microsoft.PowerShell_profile.ps1",
      "Target": "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\Microsoft.PowerShell_profile.ps1"
    },
    {
      "ComponentName": "FsutilDisable8Dot3",
      "ComponentType": "CommandRun",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Command": "fsutil.exe",
      "Arguments": [
        "behavior",
        "set",
        "disable8dot3",
        "1"
      ],
      "Validate": {
        "CommandsReturn": [
          {
            "Command": "fsutil.exe",
            "Arguments": [
              "behavior",
              "query",
              "disable8dot3"
            ],
            "Match": "The registry state is: 1 (Disable 8dot3 name creation on all volumes)."
          }
        ]
      }
    },
    {
      "ComponentName": "FsutilDisableLastAccess",
      "ComponentType": "CommandRun",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Command": "fsutil.exe",
      "Arguments": [
        "behavior",
        "set",
        "disablelastaccess",
        "1"
      ],
      "Validate": {
        "CommandsReturn": [
          {
            "Command": "fsutil.exe",
            "Arguments": [
              "behavior",
              "query",
              "disablelastaccess"
            ],
            "Match": "DisableLastAccess = 1"
          }
        ]
      }
    },
    {
      "ComponentName": "VisualStudio2015Community",
      "ComponentType": "ExeInstall",
      "Url": "http://download.microsoft.com/download/0/B/C/0BC321A4-013F-479C-84E6-4A2F90B11269/vs_community.exe",
      "Arguments": [
        "/Passive",
        "/NoRestart",
        "/full",
        "/Log",
        "C:\\log\\VisualStudio2015CommunityInstall.log"
      ],
      "DependsOn": [
        {
          "ComponentType": "ChecksumFileDownload",
          "ComponentName": "VisualStudio2015AdminDeployment"
        }
      ],
      "Validate": {
        "PathsExist": [
          "C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\Common7\\IDE\\devenv.exe",
          "C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\bin\\amd64\\mspdb140.dll",
          "C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\bin\\amd64\\vcvars64.bat",
          "C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\bin\\mspdb140.dll",
          "C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\bin\\amd64_x86\\vcvarsamd64_x86.bat"
        ]
      },
      "sha512": "fce79fd94736c6587c58fc046810b4128503cf36073d6828c3ad9bad7f51e168e512c8f7c102faf91a9a8bf42ec9d8fbca91792e044e65aeaac3786dac7c5b39"
    },
    {
      "ComponentName": "DepotTools",
      "ComponentType": "ZipInstall",
      "Url": "https://storage.googleapis.com/chrome-infra/depot_tools.zip",
      "Destination": "C:\\depot_tools",
      "sha512": "5ba69a3677e445dfae6393b8a1cf6e021c6bf626feb2e954471bb8d2577ae92efc2f0a409307d3ae659b9a6a5e2ec24fd9291edc1e13439728ae471aa8b9acf6"
    },
    {
      "ComponentName": "env_PATH",
      "ComponentType": "EnvironmentVariableUniquePrepend",
      "DependsOn": [
        {
          "ComponentType": "ZipInstall",
          "ComponentName": "DepotTools"
        }
      ],
      "Name": "PATH",
      "Values": [
        "C:\\depot_tools"
      ],
      "Target": "Machine"
    },
    {
      "ComponentName": "Git_2_11_1",
      "ComponentType": "ExeInstall",
      "Comment": "Git-2.11.1",
      "Url": "https://github.com/git-for-windows/git/releases/download/v2.11.1.windows.1/Git-2.11.1-32-bit.exe",
      "Arguments": [
        "/VerySilent"
      ],
      "Validate": {
        "PathsExist": [
          "C:\\Program Files (x86)\\Git\\git-cmd.exe",
          "C:\\Program Files (x86)\\Git\\bin\\git.exe"
        ]
      },
      "sha512": "2d7e1dc2ffb011c95bb2c0e5e21304ff8755d2dca9fff319b43811ac7746dc57077006ace899b96fa68406ecd9161525d168e90a5d31b20931d7e7ebe71f003f"
    },
    {
      "ComponentName": "gclient_init",
      "ComponentType": "CommandRun",
      "Command": "C:\\depot_tools\\gclient.bat",
      "Arguments": [
        "-v"
      ],
      "DependsOn": [
        {
          "ComponentType": "ZipInstall",
          "ComponentName": "DepotTools"
        },
        {
          "ComponentType": "ExeInstall",
          "ComponentName": "Git_2_11_1"
        }
      ]
    },
    {
      "ComponentName": "reg_WindowsErrorReportingLocalDumps",
      "ComponentType": "RegistryKeySet",
      "Comment": "",
      "Key": "HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\Windows Error Reporting",
      "ValueName": "LocalDumps"
    },
    {
      "ComponentName": "reg_WindowsErrorReportingDontShowUI",
      "ComponentType": "RegistryValueSet",
      "Comment": "",
      "Key": "HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\Windows Error Reporting",
      "ValueName": "DontShowUI",
      "ValueType": "Dword",
      "ValueData": "0x00000001",
      "Hex": true
    },
    {
      "ComponentName": "GenericWorkerDirectory",
      "ComponentType": "DirectoryCreate",
      "Path": "C:\\generic-worker"
    },
    {
      "ComponentName": "GenericWorkerDownload",
      "ComponentType": "ChecksumFileDownload",
      "DependsOn": [
        {
          "ComponentType": "DirectoryCreate",
          "ComponentName": "GenericWorkerDirectory"
        }
      ],
      "Source": "https://github.com/taskcluster/generic-worker/releases/download/v8.2.0/generic-worker-windows-amd64.exe",
      "Target": "C:\\generic-worker\\generic-worker.exe"
    },
    {
      "ComponentName": "LiveLogDownload",
      "ComponentType": "FileDownload",
      "DependsOn": [
        {
          "ComponentType": "DirectoryCreate",
          "ComponentName": "GenericWorkerDirectory"
        }
      ],
      "Source": "https://github.com/taskcluster/livelog/releases/download/v1.1.0/livelog-windows-amd64.exe",
      "Target": "C:\\generic-worker\\livelog.exe"
    },
    {
      "ComponentName": "LiveLog_Get",
      "ComponentType": "FirewallRule",
      "Protocol": "TCP",
      "LocalPort": 60022,
      "Direction": "Inbound",
      "Action": "Allow"
    },
    {
      "ComponentName": "LiveLog_Put",
      "ComponentType": "FirewallRule",
      "Protocol": "TCP",
      "LocalPort": 60023,
      "Direction": "Inbound",
      "Action": "Allow"
    },
    {
      "ComponentName": "GenericWorkerInstall",
      "ComponentType": "CommandRun",
      "Command": "C:\\generic-worker\\generic-worker.exe",
      "Arguments": [
        "install",
        "startup",
        "--config",
        "C:\\generic-worker\\generic-worker.config"
      ],
      "DependsOn": [
        {
          "ComponentType": "ChecksumFileDownload",
          "ComponentName": "GenericWorkerDownload"
        },
        {
          "ComponentType": "FileDownload",
          "ComponentName": "LiveLogDownload"
        },
        {
          "ComponentType": "FirewallRule",
          "ComponentName": "LiveLog_Get"
        },
        {
          "ComponentType": "FirewallRule",
          "ComponentName": "LiveLog_Put"
        }
      ],
      "Validate": {
        "PathsExist": [
          "C:\\generic-worker\\run-generic-worker.bat",
          "C:\\generic-worker\\generic-worker.exe"
        ],
        "CommandsReturn": [
          {
            "Command": "C:\\generic-worker\\generic-worker.exe",
            "Arguments": [
              "--version"
            ],
            "Match": "generic-worker 8.2.0"
          }
        ]
      }
    },
    {
      "ComponentName": "GenericWorkerStateWait",
      "ComponentType": "ChecksumFileDownload",
      "DependsOn": [
        {
          "ComponentType": "CommandRun",
          "ComponentName": "GenericWorkerInstall"
        }
      ],
      "Source": "https://raw.githubusercontent.com/mozilla-releng/OpenCloudConfig/master/userdata/Configuration/GenericWorker/run-generic-worker.bat",
      "Target": "C:\\generic-worker\\run-generic-worker.bat"
    },
    {
      "ComponentName": "TasksDir",
      "ComponentType": "DirectoryCreate",
      "Path": "C:\\tasks"
    },
    {
      "ComponentName": "TasksDirAccessRights",
      "ComponentType": "CommandRun",
      "Command": "icacls.exe",
      "Arguments": [
        "C:\\tasks",
        "/grant",
        "Everyone:(OI)(CI)F"
      ],
      "DependsOn": [
        {
          "ComponentType": "DirectoryCreate",
          "ComponentName": "TasksDir"
        }
      ]
    },
    {
      "ComponentName": "Mercurial",
      "ComponentType": "ExeInstall",
      "Comment": "https://bugzilla.mozilla.org/show_bug.cgi?id=1298976",
      "Url": "https://www.mercurial-scm.org/release/windows/Mercurial-3.9.1-x64.exe",
      "Arguments": [
        "/SP-",
        "/VERYSILENT",
        "/NORESTART",
        "/LOG=\"C:\\log\\Mercurial-3.9.1-x64.exe.install.log\""
      ],
      "Validate": {
        "PathsExist": [
          "C:\\Program Files\\Mercurial\\hg.exe",
          "C:\\Program Files\\Mercurial\\python27.dll"
        ]
      },
      "sha512": "b71fd8f1d1e578bbd26b7bc6635d4a9d11320bce36f24ba44152cba3c02477006ab8d6fd9b06b263d11b4327713a048156d64bcbbb073d95eede0a53675a9a80"
    },
    {
      "ComponentName": "CarbonClone",
      "ComponentType": "CommandRun",
      "Comment": "Bug 1316329 - support creation of symlinks by task users",
      "Command": "C:\\Program Files\\Mercurial\\hg.exe",
      "Arguments": [
        "clone",
        "--insecure",
        "https://bitbucket.org/splatteredbits/carbon",
        "C:\\Windows\\Temp\\carbon"
      ],
      "DependsOn": [
        {
          "ComponentType": "ExeInstall",
          "ComponentName": "Mercurial"
        }
      ],
      "Validate": {
        "PathsExist": [
          "C:\\Windows\\Temp\\carbon\\.hg"
        ]
      }
    },
    {
      "ComponentName": "CarbonUpdate",
      "ComponentType": "CommandRun",
      "Comment": "Bug 1316329 - support creation of symlinks by task users",
      "Command": "C:\\Program Files\\Mercurial\\hg.exe",
      "Arguments": [
        "update",
        "2.4.0",
        "-R",
        "C:\\Windows\\Temp\\carbon"
      ],
      "DependsOn": [
        {
          "ComponentType": "CommandRun",
          "ComponentName": "CarbonClone"
        }
      ]
    },
    {
      "ComponentName": "CarbonInstall",
      "ComponentType": "CommandRun",
      "Comment": "Bug 1316329 - support creation of symlinks by task users",
      "Command": "xcopy",
      "Arguments": [
        "C:\\Windows\\Temp\\carbon\\Carbon",
        "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\Modules\\Carbon",
        "/e",
        "/i",
        "/y"
      ],
      "DependsOn": [
        {
          "ComponentType": "CommandRun",
          "ComponentName": "CarbonUpdate"
        }
      ]
    },
    {
      "ComponentName": "GrantEveryoneSeCreateSymbolicLinkPrivilege",
      "ComponentType": "CommandRun",
      "Comment": "Bug 1316329 - support creation of symlinks by task users",
      "Command": "powershell",
      "Arguments": [
        "-command",
        "\"& {&'Import-Module' Carbon}\";",
        "\"& {&'Grant-Privilege' -Identity Everyone -Privilege SeCreateSymbolicLinkPrivilege}\""
      ],
      "DependsOn": [
        {
          "ComponentType": "CommandRun",
          "ComponentName": "CarbonInstall"
        }
      ]
    },
    {
      "ComponentName": "GrantGenericWorkerSeAssignPrimaryTokenPrivilege",
      "ComponentType": "CommandRun",
      "Comment": "Bug 1303455 - grant SeAssignPrimaryTokenPrivilege to g-w user",
      "Command": "powershell",
      "Arguments": [
        "-command",
        "\"& {&'Import-Module' Carbon}\";",
        "\"& {&'Grant-Privilege' -Identity GenericWorker -Privilege SeAssignPrimaryTokenPrivilege}\""
      ],
      "DependsOn": [
        {
          "ComponentType": "CommandRun",
          "ComponentName": "CarbonInstall"
        },
        {
          "ComponentType": "CommandRun",
          "ComponentName": "GenericWorkerInstall"
        }
      ]
    },
    {
      "ComponentName": "GrantGenericWorkerSeIncreaseQuotaPrivilege",
      "ComponentType": "CommandRun",
      "Comment": "Bug 1303455 - grant SeIncreaseQuotaPrivilege to g-w user",
      "Command": "powershell",
      "Arguments": [
        "-command",
        "\"& {&'Import-Module' Carbon}\";",
        "\"& {&'Grant-Privilege' -Identity GenericWorker -Privilege SeIncreaseQuotaPrivilege}\""
      ],
      "DependsOn": [
        {
          "ComponentType": "CommandRun",
          "ComponentName": "CarbonInstall"
        },
        {
          "ComponentType": "CommandRun",
          "ComponentName": "GenericWorkerInstall"
        }
      ]
    },
    {
      "ComponentName": "GrantGenericWorkerSeIncreaseBasePriorityPrivilege",
      "ComponentType": "CommandRun",
      "Comment": "Bug 1312383 - grant SeIncreaseBasePriorityPrivilege to g-w user",
      "Command": "powershell",
      "Arguments": [
        "-command",
        "\"& {&'Import-Module' Carbon}\";",
        "\"& {&'Grant-Privilege' -Identity GenericWorker -Privilege SeIncreaseBasePriorityPrivilege}\""
      ],
      "DependsOn": [
        {
          "ComponentType": "CommandRun",
          "ComponentName": "CarbonInstall"
        },
        {
          "ComponentType": "CommandRun",
          "ComponentName": "GenericWorkerInstall"
        }
      ]
    },
    {
      "ComponentName": "reg_PythonCpuPriority",
      "ComponentType": "RegistryValueSet",
      "Comment": "",
      "Key": "HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\python.exe\\PerfOptions",
      "ValueName": "CpuPriorityClass",
      "ValueType": "Dword",
      "ValueData": "0x00000006",
      "Hex": true
    },
    {
      "ComponentName": "reg_PythonIoPriority",
      "ComponentType": "RegistryValueSet",
      "Comment": "",
      "Key": "HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\python.exe\\PerfOptions",
      "ValueName": "IoPriority",
      "ValueType": "Dword",
      "ValueData": "0x00000002",
      "Hex": true
    }
  ]
}
